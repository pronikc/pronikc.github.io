<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Мемоленд - Реальное время</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
h1 { text-align: center; }
#uploadSection { max-width: 600px; margin: 20px auto; padding: 10px; background: #fff; border-radius: 8px; }
#gallery { max-width: 800px; margin: 20px auto; }
.meme { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; }
.meme img { max-width: 100%; border-radius: 4px; display: block; margin-bottom: 8px; }
button { padding: 8px 12px; margin-right: 10px; cursor: pointer; border: none; border-radius: 4px; background-color: #008CBA; color: #fff; }
button:hover { background-color: #007BA7; }
</style>
</head>
<body>

<h1>Мемоленд - Голосование за лучший мем</h1>

<div id="uploadSection">
  <h2>Добавить мем</h2>
  <input type="file" id="fileInput" accept="image/*" />
  <button id="uploadBtn">Загрузить</button>
</div>

<div id="gallery"></div>

<!-- Подключение socket.io -->
<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// Элементы страницы
const fileInput = document.getElementById('fileInput');
const uploadBtn = document.getElementById('uploadBtn');
const gallery = document.getElementById('gallery');

// Обновляем полностью список мемов при инициализации
socket.on('initialMemes', (memes) => {
    gallery.innerHTML = '';
    memes.forEach(renderMeme);
});

// Добавление нового мема
socket.on('newMeme', (meme) => {
    renderMeme(meme);
});

// Обновление голосов
socket.on('updateVotes', ({id, votes}) => {
    const votesSpan = document.getElementById(`votes-${id}`);
    if (votesSpan) {
        votesSpan.innerText = `Голосов: ${votes}`;
    }
});

// Создаем элемент мема
function renderMeme(meme) {
    const div = document.createElement('div');
    div.className = 'meme';

    const img = document.createElement('img');
    img.src = meme.url;

    const voteBtn = document.createElement('button');
    voteBtn.innerText = 'Голосовать';
    voteBtn.onclick = () => {
        socket.emit('vote', meme.id);
    };

    const votesSpan = document.createElement('span');
    votesSpan.id = `votes-${meme.id}`;
    votesSpan.innerText = `Голосов: ${meme.votes}`;

    div.appendChild(img);
    div.appendChild(voteBtn);
    div.appendChild(votesSpan);

    gallery.appendChild(div);
}

// Загрузка нового мема
uploadBtn.onclick = () => {
    const file = fileInput.files[0];
    if (!file) {
        alert('Выберите изображение!');
        return;
    }
    const reader = new FileReader();
    reader.onload = () => {
        socket.emit('addMeme', { url: reader.result });
    };
    reader.readAsDataURL(file);
};
</script>
</body>
</html>